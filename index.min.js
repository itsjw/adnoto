"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var freeze=require("functional-freeze");var forEach=require("lodash/forEach");var isEqual=require("lodash/isEqual");var assign=require("lodash/fp/assign");var reduce=require("lodash/reduce");var listeners=[];var effects=[];var reducers=Object.create(null);var state=freeze(Object.create(null));var isNotReducer=function isNotReducer(func){return!func||typeof func!=="function"||!func.name};var dispatch=function dispatch(action){forEach(effects,function(effect){effect(action)});var newState=freeze(reduce(reducers,function(result,reducer,key){result[key]=reducer(state[key],action);return result},{}));if(!isEqual(newState,state)){state=newState;forEach(listeners,function(listen){listen(state)})}};var addReducer=function addReducer(func){if(isNotReducer(func))throw Error("Not a reducer function.");reducers[func.name]=func;state=freeze(assign(state,_defineProperty({},func.name,func())));forEach(listeners,function(listen){listen(state)})};function initialReducers(){var result=reduce(arguments,function(result,reducer){if(isNotReducer(reducer))throw Error("Not a reducer function.");result.state[reducer.name]=reducer();result.reducers[reducer.name]=reducer;return result},{state:Object.create(null),reducers:Object.create(null)});reducers=result.reducers;state=freeze(result.state)}var subscribe=function subscribe(func){listeners.push(func)};var reset=function reset(){state=freeze(Object.create(null));reducers=Object.create(null);listeners.length=0;effects.length=0};var sideEffect=function sideEffect(func){effects.push(func)};var select=function select(func){return func(state)};module.exports={subscribe:subscribe,dispatch:dispatch,addReducer:addReducer,initialReducers:initialReducers,reset:reset,sideEffect:sideEffect,select:select};
