"use strict";var freeze=require("functional-freeze");var forEach=require("lodash/forEach");var isEqual=require("lodash/isEqual");var assign=require("lodash/fp/assign");var reduce=require("lodash/reduce");var isPlainObject=require("lodash/isPlainObject");var listeners=[];var effects=[];var reducers=Object.create(null);var state=freeze(Object.create(null));var isNotReducer=function isNotReducer(func){return typeof func!=="function"};var dispatch=function dispatch(action){forEach(effects,function(effect){effect(action)});var newState=freeze(reduce(reducers,function(result,reducer,key){result[key]=reducer(state[key],action);return result},{}));if(!isEqual(newState,state)){state=newState;forEach(listeners,function(listen){listen(state)})}};function initializeReducers(){if(!isPlainObject(arguments[0]))throw Error("Needs plain object as first argument.");var result=reduce(arguments[0],function(result,reducer,name){if(isNotReducer(reducer))throw Error("Not a reducer function.");result.state[name]=reducer();result.reducers[name]=reducer;return result},{state:Object.create(null),reducers:reducers});reducers=result.reducers;state=freeze(result.state)}var subscribe=function subscribe(func){listeners.push(func)};var reset=function reset(){state=freeze(Object.create(null));reducers=Object.create(null);listeners.length=0;effects.length=0};var sideEffect=function sideEffect(func){effects.push(func)};var select=function select(func){return func(state)};module.exports={subscribe:subscribe,dispatch:dispatch,initializeReducers:initializeReducers,reset:reset,sideEffect:sideEffect,select:select};
